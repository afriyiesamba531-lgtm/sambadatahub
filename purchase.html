<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Confirm Purchase</title>
<link rel="stylesheet" href="style.css">
<style>
/* Floating popup modal */
#successModal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  background-color: #001f3f;
  border-radius: 16px;
  padding: 25px 40px;
  color: #00eaff;
  font-size: 18px;
  font-weight: bold;
  text-align: center;
  box-shadow: 0 0 15px #00eaff, 0 0 25px #00eaff, 0 0 35px #00eaff;
  animation: bounceGlow 0.8s ease-in-out;
}

/* Bounce + neon glow animation */
@keyframes bounceGlow {
  0% { transform: translate(-50%, -60%) scale(0.5); opacity: 0; box-shadow: 0 0 5px #00eaff; }
  50% { transform: translate(-50%, -50%) scale(1.05); opacity: 1; box-shadow: 0 0 25px #00eaff, 0 0 40px #00eaff; }
  70% { transform: translate(-50%, -52%) scale(0.95); }
  100% { transform: translate(-50%, -50%) scale(1); }
}

#successModal button {
  margin-top: 15px;
  padding: 10px 20px;
  border-radius: 12px;
  border: none;
  background-color: #00eaff;
  color: #001f3f;
  font-weight: bold;
  cursor: pointer;
}

/* Confetti particles */
.particle {
  position: fixed;
  font-size: 24px;
  z-index: 9999;
  pointer-events: none;
  animation: rise 2s linear forwards;
}

@keyframes rise {
  0% { transform: translateY(0) rotate(0deg); opacity:1; }
  100% { transform: translateY(-200px) rotate(360deg); opacity:0; }
}
</style>
</head>
<body>

<!-- SIDEBAR -->
<div id="sidebar">
  <a href="index.html" class="menu-item">ğŸ  Home</a>
  <a href="data.html" class="menu-item">ğŸ“¡ Buy Data</a>
  <a href="wallet.html" class="menu-item">ğŸ’° Wallet</a>
  <a href="transactions.html" class="menu-item">ğŸ“„ History</a>
  <a href="profile.html" class="menu-item">ğŸ‘¤ Profile</a>
</div>

<div class="container">
  <div class="card">
    <h2>Confirm Purchase</h2>
    <p id="details"></p>

    <input id="phone" type="tel" placeholder="Enter phone number" style="width:100%;padding:12px;border-radius:12px;border:none;margin-top:12px;">

    <button onclick="confirmOrder()" style="
      margin-top:14px;
      width:100%;
      padding:12px;
      border-radius:14px;
      border:none;
      background:#00eaff;
      font-weight:bold;
      cursor:pointer;
    ">Confirm Purchase</button>
  </div>
</div>

<!-- Floating Popup Modal -->
<div id="successModal">
  â˜ºï¸ Order has been placed successfully ğŸ˜
  <br>
  <button onclick="closeModal()">Close</button>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const network = params.get('network');
const bundle = params.get('bundle');
const price = params.get('price');

document.getElementById('details').innerHTML =
  `<strong>Network:</strong> ${network}<br>
   <strong>Bundle:</strong> ${bundle}<br>
   <strong>Price:</strong> GHS ${price}`;

// Function to spawn Hurray particles
function spawnParticles() {
  const emojis = ['ğŸ‰','ğŸ˜','ğŸ¥³','âœ¨','ğŸŠ'];
  for(let i=0;i<15;i++){
    const p = document.createElement('div');
    p.classList.add('particle');
    p.style.left = Math.random() * window.innerWidth + 'px';
    p.innerText = emojis[Math.floor(Math.random() * emojis.length)];
    document.body.appendChild(p);
    setTimeout(()=>p.remove(), 2000);
  }
}

function confirmOrder(){
  const phone = document.getElementById('phone').value;

  if(phone.length < 9){
    alert("Enter a valid phone number");
    return;
  }

  // Direct API call
  fetch("https://s5HX8RmBLOe2WpmQdu0WAYS9z302", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer sk_test_0b5ad6ecb17aa96fd58fbfad6660fbe56351d2ad"
    },
    body: JSON.stringify({
      network: network,
      bundle: bundle,
      phone: phone
    })
  })
  .then(res => res.json())
  .then(data => {
    if(data.success){
      // Show floating modal
      document.getElementById('successModal').style.display = "block";
      // Spawn Hurray particles
      spawnParticles();
    } else {
      alert("âŒ Order failed. Please try again.");
      console.log(data);
    }
  })
  .catch(err => {
    alert("âŒ Order failed. Please try again.");
    console.log(err);
  });
}

// Close the floating modal
function closeModal(){
  document.getElementById('successModal').style.display = "none";
  // Optional: redirect back to data.html
  // window.location.href = "data.html";
}
</script>

</body>
    </html>
